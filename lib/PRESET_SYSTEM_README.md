# 图片编辑预设系统

本系统为 FLUX.1 Kontext 图片编辑功能引入了智能预设系统，让用户无需手动编写复杂的提示词，而是通过选择预设让 AI 自动分析图片并生成相应的编辑指令。

## 🎯 系统概述

### 工作原理
1. **用户上传图片** - 在图片编辑模式中上传参考图片
2. **选择预设** - 从 13 个专业预设中选择一个
3. **AI 分析** - Gemini 2.5 Flash 分析图片内容
4. **生成指令** - AI 根据预设和图片内容生成编辑指令
5. **图片生成** - FLUX.1 Kontext 执行编辑指令生成结果

### 模式切换
- **预设模式**（默认）：选择预设，AI 自动生成提示词
- **自定义模式**：手动输入提示词，传统方式

## 📋 可用预设

### 1. Komposer Teleport
**功能**：将主体传送到随机场景
**说明**：重新构建场景背景、风格、服装等，但保持主体不变

### 2. Move Camera
**功能**：移动摄像机视角
**说明**：提供不同的摄像机角度，如俯视、侧视、特写等

### 3. Relight
**功能**：重新打光
**说明**：改变照明设置，包括专业摄影棚灯光、戏剧性色彩变化等

### 4. Product
**功能**：产品摄影风格
**说明**：将图片转换为专业产品照片风格，包括使用场景展示

### 5. Zoom
**功能**：缩放特定主体
**说明**：对指定主体进行不同级别的缩放，支持自定义主体

### 6. Colorize
**功能**：着色处理
**说明**：为图片添加颜色或改变色彩风格

### 7. Movie Poster
**功能**：电影海报风格
**说明**：将图片制作成电影海报，包含标题、标语等元素

### 8. Cartoonify
**功能**：卡通化
**说明**：转换为卡通、漫画或绘画风格

### 9. Remove Text
**功能**：移除文字
**说明**：清除图片中的所有文字内容

### 10. Haircut
**功能**：改变发型
**说明**：为人物更换发型、颜色等

### 11. Bodybuilder
**功能**：健美化
**说明**：增强人物肌肉，营造健美效果

### 12. Remove Furniture
**功能**：移除家具
**说明**：清除室内的所有家具和装饰

### 13. Interior Design
**功能**：室内设计
**说明**：重新设计室内装修，保持房间结构不变

## 🔧 技术实现

### 核心组件

#### 1. PresetSelector 组件
- 预设选择下拉菜单
- 预设描述显示
- 自定义模式切换

#### 2. 预设配置系统
```typescript
// lib/presets.ts
export interface EditPreset {
  name: string
  brief: string
}
```

#### 3. API 路由
- `/api/generate-preset-prompt` - 生成预设提示词
- `/api/generate` - 图片生成（支持预设模式）

### 数据流

```
用户选择预设 → 上传图片 → 点击生成
    ↓
调用 Gemini API 分析图片
    ↓
生成编辑指令
    ↓
调用 FLUX API 生成图片
    ↓
返回结果
```

## 🎨 用户界面

### 预设模式界面
- **预设选择器**：下拉菜单显示所有预设
- **预设描述**：显示当前选择预设的详细说明
- **主体输入**：Zoom 预设支持指定缩放主体
- **指令预览**：显示 AI 生成的编辑指令
- **切换按钮**：切换到自定义模式

### 自定义模式界面
- **提示词输入框**：传统的手动输入方式
- **返回按钮**：返回预设模式

## 🔄 模式对比

| 特性 | 预设模式 | 自定义模式 |
|------|----------|------------|
| 易用性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 专业性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 灵活性 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 学习成本 | ⭐ | ⭐⭐⭐⭐ |
| 图片要求 | 必需 | 可选 |

## 🚀 使用示例

### 预设模式使用流程
1. 选择图片编辑模型（Pro/Max/Max Multi）
2. 上传参考图片
3. 选择预设（如 "Movie Poster"）
4. 点击"生成编辑指令"
5. 查看 AI 生成的指令
6. 点击"生成图片"

### 自定义模式使用流程
1. 选择图片编辑模型
2. 上传参考图片（可选）
3. 点击"切换到自定义提示词"
4. 手动输入编辑指令
5. 点击"生成图片"

## ⚙️ 配置要求

### 环境变量
```env
# Gemini API（用于预设提示词生成）
OPENAI_API_KEY=your_gemini_api_key
OPENAI_BASE_URL=https://generativelanguage.googleapis.com/v1beta/openai/

# FAL API（用于图片生成）
FAL_KEY=your_fal_api_key
```

### 模型支持
- ✅ FLUX.1 Kontext Pro（图片编辑）
- ✅ FLUX.1 Kontext Max（图片编辑）
- ✅ FLUX.1 Kontext Max Multi（多图片编辑）
- ❌ FLUX.1 Kontext Pro/Max Text-to-Image（文生图，不支持预设）

## 🎯 优势特点

1. **降低使用门槛**：无需学习复杂的提示词编写
2. **专业化指令**：基于专业摄影和设计知识的预设
3. **智能分析**：AI 自动理解图片内容和上下文
4. **一键切换**：预设模式和自定义模式随时切换
5. **实时预览**：显示生成的编辑指令供用户确认

## 📝 注意事项

1. **图片要求**：预设模式必须上传参考图片
2. **网络依赖**：需要稳定的网络连接调用 Gemini API
3. **处理时间**：AI 分析图片需要额外时间
4. **语言支持**：当前预设系统使用英文指令
5. **模型限制**：仅支持图片编辑模型，不支持文生图模型
